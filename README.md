# bewise-test-jun
 
## Bewise Test ##

#### Запуск скрипта ####
    python parse_dialogs.py
 
По умолчанию скрипт читает данные из файла test_data.csv

#### Данные ####
##### В файле обазательно дажны присутствовать: #####
    dlg_id - id диалога
    role - кто говорит: менеджер или клиент
    text - реплика

#### Возможные ключи для запуска: ####
	'-i', '--input_file' - указание файла для парсинга. По умолчанию - test_data.csv
	'-d', '--delimiter' - разделиель во входном файле. По умолчанию - ,
	'-o', '--output_file' - выходной файл, если нужно записать рещультат в файл. По умолчанию - None
	'-gfk', '--greet_fare_k' - первые и посдение k фраз менеджера для поиска приветсвия и прощания. По умолчанию - 3
	'-nk', '--names_k' - первые k строк для поиска имени менеджера и названия омпании. По умолчанию - 10
	'-ng_min', '--ngrams_min' - минимальное число n для n-грамм. По умолчанию - 2
	'-ng_max', '--ngrams_max' - максимальное число n для n-грамм. По умолчанию - 3
    
#### Файл с примером example_data.csv ####
\*данные были изменены
##### Запуск скрипта для тестового файла #####
	python parse_dialogs.py -i example_data.csv -o output.txt

<details>
    <summary>example_data.csv</summary>
    dlg_id,line_n,role,text  <br />
	0,0,client,Алло  <br />
	0,1,manager,Привет  <br />
	0,2,client,Добрый день  <br />
	0,3,manager,Меня зовут анатолий это компания неожиданность вам точно сейчас что то нужно  <br />
	0,4,client,Отстаньте  <br />
	0,5,manager,Прощайте  <br />
</details>
<details>
    <summary>output.txt</summary>
    Диалог № 0.  <br />
	Менеджер поздоровался тут: "Привет"  <br />
	Менеджер представился тут: "Меня зовут анатолий это компания неожиданность вам точно сейчас что то нужно"  <br />
	Менеджера зовут: "Анатолий"  <br />
	Менеджер из компании: "Неожиданность"  <br />
	Менеджер попрощался тут: "Прощайте"  <br />
	Менеджер поздоровался и попрощался.  <br />
</details>

### Как парсится: ###
### Приветствие ###
Приветствие ищется по умолчанию в первых 3 репликах менеджера. Каждая раплика разбивается на 2-3 граммы, если длина фразы повзволяет, если нет - остается одно слово.
Каждая n-грамма матчится с фразой из словаря greetings.txt
80% квантиль записывается как вероятность, что во фразе есть приветствие. Если вероятности не превышают 50% - во фразе нет приветствия.
Матчинг фразы на основе ['cointegrated/rubert-base-cased-nli-threeway'](https://huggingface.co/cointegrated/rubert-base-cased-nli-threeway).
### Прощание ###
Прощание ищется по умолчанию в последних 3 репликах менеджера. Каждая раплика разбивается на 2-3 граммы, если длина фразы повзволяет, если нет - остается одно слово.
Каждая n-грамма матчится с фразой из словаря afrewells.txt
80% квантиль записывается как вероятность, что во фразе есть прощание. Если вероятности не превышают 50% - во фразе нет прощания.
Матчинг фразы на основе ['cointegrated/rubert-base-cased-nli-threeway'](https://huggingface.co/cointegrated/rubert-base-cased-nli-threeway).
### Имя менеджера ###
Имя менеджера парсится из всей фразы. Для парсинга используется Yargy. Предшествующий имени словарь - {'меня', 'зовут', 'я', 'это', 'мое', 'имя', 'вас', 'беспокоит'}  \
После этих слова ищется имя. Если парсинг имени не нашел, то, соответсвенно в результат записывается пустая строка и имени во фразе нет.
### Название компании ###
По аналогии с именем менеджера. Предшествующий имени словарь - {'компания', 'фирма', 'организация', 'предприятие', 'контора', 'ООО', 'ЗАО', 'ОАО', 'АО', 'ПАО', 'ИП'}  \
После этих слова ищется существительные с повторением. Если парсинг соответствия не нашел, то результат записывается пустая строка и названии компании во фразе нет.